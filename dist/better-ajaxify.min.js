/**
 * better-ajaxify: Ajax website engine for better-dom
 * @version 2.1.0-beta.1 Sun, 08 Oct 2017 14:28:38 GMT
 * @link https://github.com/chemerisuk/better-ajaxify
 * @copyright 2017 Maksim Chemerisuk
 * @license MIT
 */
!function(e,t,a){"use strict";function n(t,a){e.addEventListener(t,function(e){e.defaultPrevented||a(e)},!1)}function r(t,a,n){var r=e.createEvent("CustomEvent");return r.initCustomEvent("ajaxify:"+a,!0,!0,n||null),t.dispatchEvent(r)}function i(t,a){var n=e.body,i=(t.body||a.body||{}).id;if(i&&(n=e.getElementById(i)||n),9===a.nodeType){t.body=n.cloneNode(!1);for(var o=a.body.firstChild;o;o=a.body.firstChild)t.body.appendChild(o)}r(n,"update",t.body)&&n.parentNode.replaceChild(t.body,n),l.body=n,l.title=e.title,s.indexOf(l)<0&&s.push(l),e.title=t.title}if("function"==typeof a.pushState){var o,d=function(e){return e},s=[],l={};n("click",function(a){for(var n=e.body,i=a.target;i&&i!==n;i=i.parentNode)if("a"===i.nodeName.toLowerCase()){if(!i.target){var o=i.href;if("true"===i.getAttribute("aria-disabled"))a.preventDefault();else if(o&&0===o.indexOf("http")){var d=t.href;o===d||o.split("#")[0]!==d.split("#")[0]?r(i,"fetch")&&a.preventDefault():(t.hash=i.hash,a.preventDefault())}}break}}),n("submit",function(e){var t=e.target;if(!t.target)if("true"===t.getAttribute("aria-disabled"))e.preventDefault();else{var a,n=t.getAttribute("enctype");if("multipart/form-data"===n)a=new FormData(t);else{a={};for(var i,s=0;i=t.elements[s];++s){var l=i.type;if(l&&i.name&&!i.disabled){var f=i.name;if("select-multiple"===l)for(var u,p=0;u=i.options[p];++p)u.selected&&(a[f]=a[f]||[]).push(u.value);else("checkbox"!==l&&"radio"!==l||i.checked)&&(a[f]=i.value)}}}if(r(t,"serialize",a)){if(a instanceof FormData)o=a;else{var c="text/plain"===n?d:encodeURIComponent,v=c===d?/ /g:/%20/g;o=Object.keys(a).map(function(e){var t=c(e),n=a[e];return Array.isArray(n)&&(n=n.map(c).join("&"+t+"=")),t+"="+c(n)}).join("&").replace(v,"+")}r(t,"fetch")&&e.preventDefault(),o=null}else e.preventDefault()}}),n("ajaxify:fetch",function(n){var d=n.target,f=n.detail;if(f&&9===f.nodeType){var u={title:f.title};i(u,f),l={},f.URL!==t.href&&a.pushState(s.length,u.title,f.URL)}else{var p=new XMLHttpRequest,c=(d.method||"GET").toUpperCase(),v=d.nodeName.toLowerCase(),h=d.nodeType,y=f;"a"===v?y=y||d.href:"form"===v&&(y=y||d.action,"GET"===c&&o&&(y+=(~y.indexOf("?")?"&":"?")+o,o=null)),["abort","error","load","timeout"].forEach(function(n){p["on"+n]=function(){1===h&&d.removeAttribute("aria-disabled");var o=p.response,f=p.responseURL;if(!f&&o&&o.URL&&(f=p.getResponseHeader("Location"),f&&(f=t.origin+f,Object.defineProperty(p,"responseURL",{get:function(){return f}}))),r(d,n,p)&&"load"===n){var u=p.status+" "+p.statusText,c=o||e.implementation.createHTMLDocument(u),v={title:c.title||u};i(v,c),l={},f!==t.href&&a.pushState(s.length,v.title,f)}}}),p.open(c,y,!0),p.responseType="document",r(d,"send",p)&&(p.setRequestHeader("X-Requested-With","XMLHttpRequest"),"GET"!==c&&p.setRequestHeader("Content-Type",d.getAttribute("enctype")||d.enctype),p.send(o),1===h&&d.setAttribute("aria-disabled","true"))}}),window.addEventListener("popstate",function(e){if(!e.defaultPrevented&&e.state>=0){var t=s[e.state];t&&(i(t,t.body),l=t)}}),a.replaceState(0,e.title)}}(window.document,window.location,window.history);