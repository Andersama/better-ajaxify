/**
 * better-ajaxify: Ajax website engine for better-dom
 * @version 2.0.0-beta.4 Tue, 07 Mar 2017 12:04:52 GMT
 * @link https://github.com/chemerisuk/better-ajaxify
 * @copyright 2017 Maksim Chemerisuk
 * @license MIT
 */
!function(e,t,a){"use strict";function n(t,a){e.addEventListener(t,function(e){e.defaultPrevented||a(e)},!1)}function i(t,a,n){var i=e.createEvent("CustomEvent");return i.initCustomEvent("ajaxify:"+a,!0,!0,n||null),t.dispatchEvent(i)}function r(t,a){var n=e.body;i(n,"update",a)&&n.parentNode.replaceChild(t.body,n),u.indexOf(l)<0&&u.push(l),e.title=t.title}if(a.pushState&&("timeout"in XMLHttpRequest.prototype||window.jasmine)){var o,s=function(e){return e},d=/<title>(.*?)<\/title>/,u=[],l={};n("click",function(a){var n,r=a.target;if("a"===r.nodeName.toLowerCase())n=r;else{var o=e.activeElement;"a"===o.nodeName.toLowerCase()&&o.contains(r)&&(n=o)}if(n&&!n.target)if("true"===n.getAttribute("aria-disabled"))a.preventDefault();else if("http"===n.protocol.slice(0,4)){var s=n.href,d=t.href;s===d||s.split("#")[0]!==d.split("#")[0]?i(n,"fetch")&&a.preventDefault():(t.hash=n.hash,a.preventDefault())}}),n("submit",function(e){var t=e.target;if(!t.target)if("true"===t.getAttribute("aria-disabled"))e.preventDefault();else{var a,n=t.getAttribute("enctype");if("multipart/form-data"===n)a=new FormData(t);else{a={};for(var r,d=0;r=t.elements[d];++d){var u=r.type;if(u&&r.name&&!r.disabled){var l=r.name;if("select-multiple"===u)for(var f,p=0;f=r.options[p];++p)f.selected&&(a[l]=a[l]||[]).push(f.value);else("checkbox"!==u&&"radio"!==u||r.checked)&&(a[l]=r.value)}}}if(i(t,"serialize",a)){if(a instanceof FormData)o=a;else{var c="text/plain"===n?s:encodeURIComponent,v=c===s?/ /g:/%20/g;o=Object.keys(a).map(function(e){var t=c(e),n=a[e];return Array.isArray(n)&&(n=n.map(c).join("&"+t+"=")),t+"="+c(n)}).join("&").replace(v,"+")}i(t,"fetch")&&e.preventDefault(),o=null}else e.preventDefault()}}),n("ajaxify:fetch",function(e){var t=e.target,a=new XMLHttpRequest,n=(t.method||"GET").toUpperCase(),r=t.nodeName.toLowerCase(),s=e.detail;"a"===r?s=s||t.href:"form"===r&&(s=s||t.action,"GET"===n&&(s+=(~s.indexOf("?")?"&":"?")+o,o=null)),["abort","error","load","timeout"].forEach(function(e){a["on"+e]=function(){1===t.nodeType&&t.removeAttribute("aria-disabled"),i(t,e,a)}}),a.onreadystatechange=function(){var e=a.status;2===a.readyState&&304!==e&&(e<200||e>300)&&(a.responseType="text")},a.open(n,s,!0),a.responseType="document",i(t,"send",a)&&(a.setRequestHeader("X-Requested-With","XMLHttpRequest"),"GET"!==n&&a.setRequestHeader("Content-Type",t.getAttribute("enctype")||t.enctype),a.send(o),1===t.nodeType&&t.setAttribute("aria-disabled","true"))}),e.addEventListener("ajaxify:load",function(e){var t=e.detail,a=t.response,n=t.responseURL;!n&&a&&a.URL&&(n=t.getResponseHeader("Location"),n=n?a.URL.split("/").slice(0,3).join("/")+n:a.URL,Object.defineProperty(t,"responseURL",{get:function(){return n}}))},!0),n("ajaxify:load",function(e){var n=e.detail,i=n.response,o={};i.body?(o.body=i.body,o.title=i.title):(o.body=i,o.title=n.status+" "+n.statusText),r(o,n.response),l={};var s=n.responseURL;s!==t.href&&a.pushState(u.length,o.title,s)}),e.addEventListener("ajaxify:update",function(t){var a=t.detail;if("string"==typeof a){var n=d.exec(a),i=e.implementation.createHTMLDocument(n&&n[1]||"");i.body.innerHTML=a.trim().replace(n&&n[0],""),Object.defineProperty(t,"detail",{get:function(){return i}})}l.body=t.target,l.title=e.title},!0),window.addEventListener("popstate",function(e){if(!e.defaultPrevented&&e.state>=0){var t=u[e.state];t&&(r(t,t.body),l=t)}}),a.replaceState(0,e.title)}}(window.document,window.location,window.history);