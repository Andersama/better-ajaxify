/**
 * better-ajaxify: A simple PJAX engine for websites
 * @version 3.0.0-beta.5 Wed, 18 Nov 2020 13:38:12 GMT
 * @link https://github.com/chemerisuk/better-ajaxify
 * @copyright 2020 Maksim Chemerisuk
 * @license MIT
 */
!function(){"use strict";!function(t){function e(t,e,r){t.addEventListener(e,function(t){t.defaultPrevented||r(t)},!1)}function r(t,e,r){var a=n.createEvent("CustomEvent");return a.initCustomEvent("ajaxify:"+e,!0,!0,r||null),t.dispatchEvent(a)}var n=t.document,a=t.location,i=t.history,o=t.fetch,f=t.Request,c=t.URLSearchParams;if(o&&f&&c){var l=new DOMParser,u=[],d={};e(n,"click",function(t){for(var e=n.body,i=t.target;i&&i!==e;i=i.parentNode)if("a"===i.nodeName.toLowerCase()){var o=i.href;if(!i.target&&o&&0===o.indexOf("http")){var c=a.href;o.split("#")[0]!==c.split("#")[0]&&(r(i,"fetch",new f(o)),t.preventDefault())}break}}),e(n,"submit",function(t){var e=t.target,n=e.action;if(!e.target||!n||0===n.indexOf("http")){var a=new FormData(e);if(r(e,"serialize",a)){var i=e.method.toUpperCase()||"GET",o=e.getAttribute("enctype")||e.enctype,l={method:i,headers:{"Content-Type":o}};if("multipart/form-data"===o)l.body=a;else{var u=new c(a);if("GET"===l.method)n+=(~n.indexOf("?")?"&":"?")+u;else if("application/json"!==o)l.body=u.toString();else{var d={};u.forEach(function(t,e){Array.isArray(d[e])?d[e].push(t):e in d?d[e]=[d[e],t]:d[e]=t}),l.body=JSON.stringify(d)}}r(e,"fetch",new f(n,l)),t.preventDefault()}}}),e(n,"ajaxify:fetch",function(t){var e=t.target,n=t.detail;o(n).then(function(t){r(e,"load",t)})["catch"](function(t){if(r(e,"error",t))throw t})}),e(n,"ajaxify:load",function(t){var e=t.target,n=t.detail;n.text().then(function(t){var o=l.parseFromString(t,"text/html");r(e,"render",o)&&(n.url!==a.href.split("#")[0]?i.pushState(u.length,o.title,n.url):i.replaceState(u.length-1,o.title,n.url))})["catch"](function(t){if(r(e,"error",t))throw t})}),e(n,"ajaxify:render",function(t){var e=t.detail;d.body=n.body,d.title=n.title,u.indexOf(d)>=0?d=e:(u.push(d),d={}),n.documentElement.replaceChild(e.body,n.body),n.title=e.title}),e(t,"popstate",function(t){var e=t.state;if("number"==typeof e){var i=u[e];i?r(n,"render",i):r(n,"fetch",new f(a.href))}}),i.replaceState(0,n.title)}}(window)}();