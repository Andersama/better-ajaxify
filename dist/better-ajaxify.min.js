/**
 * better-ajaxify: Ajax website engine for better-dom
 * @version 2.0.0-rc.1 Thu, 16 Mar 2017 15:02:35 GMT
 * @link https://github.com/chemerisuk/better-ajaxify
 * @copyright 2017 Maksim Chemerisuk
 * @license MIT
 */
!function(e,t,a){"use strict";function n(t,a){e.addEventListener(t,function(e){e.defaultPrevented||a(e)},!1)}function i(t,a){e.addEventListener("ajaxify:update",a,!0)}function r(t,a,n){var i=e.createEvent("CustomEvent");return i.initCustomEvent("ajaxify:"+a,!0,!0,n||null),t.dispatchEvent(i)}function o(t,a){var n=e.body;r(n,"update",a)&&n.parentNode.replaceChild(t.body,n),f.indexOf(p)<0&&f.push(p),e.title=t.title}function s(t){var a=l.exec(t),n=e.implementation.createHTMLDocument(a&&a[1]||"");return n.body.innerHTML=t.trim().replace(a&&a[0],""),n}if(a.pushState&&("timeout"in XMLHttpRequest.prototype||window.jasmine)){var u,d=function(e){return e},l=/<title>(.*?)<\/title>/,f=[],p={};n("click",function(a){for(var n=e.body,i=a.target;i!==n;i=i.parentNode)if("a"===i.nodeName.toLowerCase()){if(!i.target)if("true"===i.getAttribute("aria-disabled"))a.preventDefault();else if("http"===i.protocol.slice(0,4)){var o=i.href,s=t.href;o===s||o.split("#")[0]!==s.split("#")[0]?r(i,"fetch")&&a.preventDefault():(t.hash=i.hash,a.preventDefault())}break}}),n("submit",function(e){var t=e.target;if(!t.target)if("true"===t.getAttribute("aria-disabled"))e.preventDefault();else{var a,n=t.getAttribute("enctype");if("multipart/form-data"===n)a=new FormData(t);else{a={};for(var i,o=0;i=t.elements[o];++o){var s=i.type;if(s&&i.name&&!i.disabled){var l=i.name;if("select-multiple"===s)for(var f,p=0;f=i.options[p];++p)f.selected&&(a[l]=a[l]||[]).push(f.value);else("checkbox"!==s&&"radio"!==s||i.checked)&&(a[l]=i.value)}}}if(r(t,"serialize",a)){if(a instanceof FormData)u=a;else{var c="text/plain"===n?d:encodeURIComponent,v=c===d?/ /g:/%20/g;u=Object.keys(a).map(function(e){var t=c(e),n=a[e];return Array.isArray(n)&&(n=n.map(c).join("&"+t+"=")),t+"="+c(n)}).join("&").replace(v,"+")}r(t,"fetch")&&e.preventDefault(),u=null}else e.preventDefault()}}),n("ajaxify:fetch",function(e){var t=e.target,a=new XMLHttpRequest,n=(t.method||"GET").toUpperCase(),i=t.nodeName.toLowerCase(),o=t.nodeType,s=e.detail;"a"===i?s=s||t.href:"form"===i&&(s=s||t.action,"GET"===n&&u&&(s+=(~s.indexOf("?")?"&":"?")+u,u=null)),["abort","error","load","timeout"].forEach(function(e){a["on"+e]=function(){1===o&&t.removeAttribute("aria-disabled"),r(t,e,a)}}),a.open(n,s,!0),r(t,"send",a)&&(a.setRequestHeader("X-Requested-With","XMLHttpRequest"),"GET"!==n&&a.setRequestHeader("Content-Type",t.getAttribute("enctype")||t.enctype),a.send(u),1===o&&t.setAttribute("aria-disabled","true"))}),i("ajaxify:load",function(e){var a=e.detail,n=a.response,i=a.responseURL;!i&&n&&n.URL&&(i=a.getResponseHeader("Location"),i&&(i=t.origin+i,Object.defineProperty(a,"responseURL",{get:function(){return i}})))}),n("ajaxify:load",function(e){var n=e.detail,i=s(n.responseText),r={body:i.body};i.title?r.title=i.title:r.title=n.status+" "+n.statusText,o(r,i),p={};var u=n.responseURL;u!==t.href&&a.pushState(f.length,r.title,u)}),i("ajaxify:update",function(t){var a=t.detail;"string"==typeof a&&(a=s(a),Object.defineProperty(t,"detail",{get:function(){return a}})),p.body=t.target,p.title=e.title}),window.addEventListener("popstate",function(e){if(!e.defaultPrevented&&e.state>=0){var t=f[e.state];t&&(o(t,t.body),p=t)}}),a.replaceState(0,e.title)}}(window.document,window.location,window.history);